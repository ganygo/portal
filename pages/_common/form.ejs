<%
  if(typeof mode=='undefined') mode=func;
  if(typeof action=='undefined') action='';
  if(typeof caption=='undefined') caption='';
  if(typeof formName=='undefined') formName='form-general';
  if(typeof message=='undefined') message='';

  if(typeof tabs=='undefined') showTabs=false;

 
  switch(mode){
    case 'edit':
      funcTitle='Değiştir'
    break;
    case 'view':
      funcTitle='İncele'
    break;
    case 'addnew':
      funcTitle='*Yeni*'
    break;
  }

  headerButtons='';
  if(mode!='view'){
    headerButtons +='<button type="submit" form="' + formName + '" class="btn btn-primary" title="Kaydet"><i class="fas fa-save"></i></button>';
  }
  if(typeof printUrl!='undefined'){
    if(typeof form!='undefined'){
      if(typeof form._id!='undefined'){
        printUrl=printUrl.replaceAll('{_id}',form._id);
      }
    }
    headerButtons +='<a href="javascript:printForm();" class="btn btn-info" title="Yazdır"><i class="fas fa-print"></i></a>';
    
  }
  headerButtons +='<a href="javascript:openBack();" class="btn btn-dark ml-2" title="Vazgeç"><i class="fas fa-reply"></i></a>';
  console.log('headerButtons:',headerButtons);
%>
<script type="text/javascript">
    var headerButtons=document.getElementById('headerButtons');
    if(headerButtons){
      headerButtons.innerHTML='<%- headerButtons %>';
    }

    function printForm(){
      <% if(typeof printUrl!='undefined') { %>
      popupCenter('/general/print/preview?db=<%=db%>&sid=<%=sid%>&path=<%=printUrl%>','Yazdir - <%=title%>','900','600');
      <% } %>
    }
</script>
<form action="<%=action%>" method="POST" role="form" name="<%=formName%>" id="<%=formName%>">
  
  <% if(message!=''){ %>
  <div class="row">
    <div class="col-lg-12 col-md-12">
          <div class="alert alert-danger" role="alert">
            <%=message %>
          </div>
    </div>
  </div>
  <% } %>
  <% if(caption!=''){ %>
   <div class="row">
    <div class="col-lg-12 col-md-12">
          <center><h3><%=caption%></h3></center>
    </div>
  </div>
  <% } %>
    <% if(typeof tabs!='undefined'){ %>
    <%
      var bFound=false;
      for(var tabIndex=0;tabIndex<tabs.length;tabIndex++){
        if(typeof tabs[tabIndex].active=='undefined') tabs[tabIndex].active=false;
        if(tabs[tabIndex].active) bFound=true;
      }
      if(bFound==false && tabs.length>0) tabs[0].active=true;
    %>
    <ul class="nav nav-tabs" role="tablist">
      <% for(var tabIndex=0;tabIndex<tabs.length;tabIndex++){ %>
      <li class="nav-item">
          <a class="nav-link<%- tabs[tabIndex].active?' active':'' %>" href="#formTab<%=tabIndex%>" role="tab" data-toggle="tab" id="IDformTab<%=tabIndex%>" aria-controls="formTab<%=tabIndex%>" aria-selected="<%- tabs[tabIndex].active?'true':'false' %>">
              <% if(typeof tabs[tabIndex].icon!='undefined'){%><i class="fa fa-<%=tabs[tabIndex].icon %>"></i><%}%> <%=tabs[tabIndex].caption %>
          </a>
      </li>
      <% } %>
    </ul>
    <div class="tab-content" style="min-height: 70vh;overflow: auto;">
      <% for(var tabIndex=0;tabIndex<tabs.length;tabIndex++){ %>
        <div class="tab-pane<%- tabs[tabIndex].active?' show active':''%> " id="formTab<%=tabIndex%>" role="tabpanel" aria-labelledby="IDformTab<%=tabIndex%>">
          <% if(typeof tabs[tabIndex].partial!='undefined'){ %>
          <%- partial(tabs[tabIndex].partial,form) %>
          <% } %>

          <% if(typeof tabs[tabIndex].formControls!='undefined'){ %>
          <%- standartForm(tabs[tabIndex]) %>
          <% } %>

       </div>
       <% } %>
    </div>
 <% } else { %>
    <%- standartForm(this) %>
 <% } %>
  
</form>

<script type="text/javascript">
  function openBack(){
    window.location.href=document.referrer;
    // if(localStorage.getItem('returnUrl')){
    //   var returnUrl=localStorage.getItem('returnUrl');
    //   localStorage.removeItem('returnUrl');

    //   if(returnUrl.indexOf('db=<%=db%>')>0 && returnUrl.indexOf('sid=<%=sid%>')>0){
    //     window.location.href=returnUrl;
    //   }else{
    //     history.back(1);
    //   }
    // }else{
    //   history.back(1);
    // }
  }
</script>

<% function standartForm(formObject){ %>
  <div class="row">
      <div class="col-lg-12 col-md-12">
            <% 
              var partialData={};
              partialData.formControls=formObject.formControls;
              partialData.mode=formObject.mode;
              
            %>
            <%- partial('form-partial', partialData) %>
      </div>
  </div>
<% } %>

