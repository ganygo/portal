<%layout('../../_common/layouts/general')%>

<%- partial('../../_common/components/grid2',{
    fields:[
        {field:'module',    title:'Modul',    type:'lookup' , filter:true, lookup:printDesignModuleList}, 
        {field:'name',title:'Adı',type:'string',filter:true, orderable:true},
        {field:'isDefault',title:'Varsayılan?',type:'boolean',width:1},
        {field:'passive',title:'Pasif?',type:'boolean',width:1},
    ],
    title:'Yazdırma Tasarımları',
    addNewButton:true,
    editButton:true,
    deleteButton:true,
    viewButton:true,
    deleteUrl:`/dbapi/print-designs/{_id}?sid=${sid}`,
    customButtons:[
        {inline:true, href:`javascript:itemCopyConfirm('{_id}','{name}')`, title:'Kopyala',icon:'far fa-copy'}
    ]
    }) 
%>


<%- partial('../../_common/forms/modal',{
    modalId:'itemCopyModal',
    title:'Kopya',
    controls:{
        newName:{title:'Yeni yazdirma tasarimi', type:'string', default:''}
    },
    mode:'addnew',
    buttons:[
        {isCancelButton:true},
        {href:'javascript:itemCopySave()', title:'Kopyala',  title:'Kopyala',icon:'far fa-copy', class:'btn btn-primary'}
    ]
}) %>

<script type="text/javascript">
    var temp_id, temp_name;
    function itemCopyConfirm(id, name){
        temp_id=id;
        temp_name=name;
        $('#newName').val(incString(name));
        $('#itemCopyModal').modal('show');
    }

    function itemCopySave(){
        if($('#newName').val().trim()==''){
            alert('Isim bos olamaz');
            return;
        }
        $('#itemCopyModal').modal('hide');

        var data={id:temp_id, newName:$('#newName').val()}
        $.ajax({
            url:`/dbapi/print-designs/copy?sid=${q.sid}`,
            data:data,
            type:'POST',
            success:function(result){
                if(result.success){
                    window.location.reload();
                }else{
                    $('#itemCopyModal').modal('show');
                    alert(result.error.code + ' - ' + result.error.message);
                }
            }
        });
       
    }
</script>