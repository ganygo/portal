<%layout('../../_common/layouts/general')%>
<div id="grid1"></div>
<script type="text/javascript">
	var orgList=<%- JSON.stringify(list) %>
	var list=[]
	orgList.forEach((e)=>{
		e['tarih']='2020-06-09'
		list.push(e)
	})

	
	var data=<%- JSON.stringify(ui) %>
	var productTypeList=<%- JSON.stringify(productTypeList) %>
	var accountGroupList=<%- JSON.stringify(accountGroupList) %>

  var columns=[
  {title:"Turu", field:"itemType", type:"lookup", lookup:productTypeList},
  {title:"Adı", field:"name.value", type:"string"},
  {title:"Açıklama", field:"description.value", type:"string"},
  {title:"Lot No?", field:"tracking.lotNo", type:"boolean"},
  {title:"Seri No?", field:"tracking.serialNo", type:"boolean"},
  {title:"Renk?", field:"tracking.color", type:"boolean"},
  {title:"Desen?", field:"tracking.pattern", type:"boolean"},
  {title:"Beden?", field:"tracking.size", type:"boolean"},
  {title:"Muh.Grup", field:"accountGroup", type:"lookup",lookup:accountGroupList},
  {title:"Pasif?", field:"passive",type:"boolean"}
  ]

  document.querySelector('#grid1').innerHTML= gridBuilder.generateGrid(columns,{
  	editable:true,
  	hidable:true,
  	selection:true,
  	filter:true,
  	buttons:{
  		add:true,
  		edit:true,
  		delete:true,
  		view:true,
  		print:true
  	}
  },data)
</script>

<!-- partial('../../_common/components/grid2',{
    fields:[
        {name:'itemType',text:'Turu',type:'lookup', lookupList:productTypeList , filter:true, filterField:'itemType', orderable:true},
        {name:'name.value',text:'Adı',type:'label' , filter:true, filterField:'name', orderable:true},
        {name:'description.value',text:'Açıklama',type:'label' , filter:true, filterField:'description', orderable:true},
        {name:'accountGroup',text:'Muh.Grup',type:'lookup' ,lookupList:accountGroupList, filter:true, textField:'name',valueField:'_id', orderable:true},
        {name:'tracking.lotNo',text:'Lot No?',type:'checkbox',width:'100px', filter:true, orderable:true},
        {name:'tracking.serialNo',text:'Seri No?',type:'checkbox',width:'100px', filter:true, orderable:true},
        {name:'tracking.color',text:'Renk?',type:'checkbox',width:'100px', filter:true, orderable:true},
        {name:'tracking.pattern',text:'Desen?',type:'checkbox',width:'100px', filter:true, orderable:true},
        {name:'tracking.size',text:'Beden?',type:'checkbox',width:'100px', filter:true, orderable:true},
        {name:'passive',text:'Pasif',type:'checkbox',width:1, filter:true, orderable:true}
    ],
    caption:'',
    addNewButton:true,
    editButton:true,
    deleteButton:true,
    viewButton:true,
    customButtons:[
        {inline:true, href:`javascript:itemCopyConfirm('{_id}','{name.value}')`, title:'Kopyala',icon:'far fa-copy'}
    ],
    deleteUrl:`/dbapi/items/{_id}?sid=${sid}`
    }) 
  -->


<!-- partial('../../_common/forms/modal',{
    modalId:'itemCopyModal',
    caption:'Kopya',
    formControls:{
        newName:{caption:'Yeni isim', type:'textbox', default:''}
    },
    mode:'addnew',
    buttons:[
        {isCancelButton:true},
        {href:'javascript:itemCopySave()', title:'Kopyala',  text:'Kopyala',icon:'far fa-copy', class:'btn btn-primary'}
    ]
})
 -->
<script type="text/javascript">
    var temp_id, temp_name;
    function itemCopyConfirm(_id, name){
        temp_id=_id;
        temp_name=name;
        $('#newName').val(name + ' kopya');
        $('#itemCopyModal').modal('show');
    }

    function itemCopySave(){
        if($('#newName').val().trim()==''){
            alert('Isim bos olamaz');
            return;
        }
        $('#itemCopyModal').modal('hide');

        var data={id:temp_id, newName:$('#newName').val()}
        $.ajax({
            url:`/dbapi/items/copy?sid=${q.sid}`,
            data:data,
            type:'POST',
            success:function(result){
                if(result.success){
                    window.location.reload();
                }else{
                    $('#itemCopyModal').modal('show');
                    alert(result.error.code + ' - ' + result.error.message);
                }
            }
        });
       
    }
</script>